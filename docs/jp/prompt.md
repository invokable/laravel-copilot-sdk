# プロンプト最適化

## 最終結果だけを最後のアシスタントメッセージで送信する
AIにhtmlなどを生成させてそのまま使いたい場合、`Copilot::run()`の結果にAIからの応答が含まれていることがよくある。「最終結果だけを最後のアシスタントメッセージで送信」するように指示を書いておけば大体上手くいく。SDKの動作を見て一つのプロンプトに対して色々メッセージを送って来ているのが分かったのでこれが有効そう。

```php
use Revolution\Copilot\Facades\Copilot;

$prompt = '次の文章を要約してください。AIによる応答を含まない最終結果だけを一番最後のアシスタントメッセージとして送ってください。
----
...（ここに長い文章が入る）...';
$response = Copilot::run($prompt);
echo $response->content();
```

別のファイルに書き出すのも有効だったけどファイルIOの手間が増える。
大体ではなく確実さが必要ならファイルに書き出した方がいい。ファイル書き出し方式なら100%成功している。SDK経由でもファイルを生成する権限は最初からある。

他には切り取る用のタグを指定しておくのもいいかも。

```php
$response = Copilot::run('次の文章を英語に翻訳してください。翻訳結果を<translated>タグで囲んで一番最後のアシスタントメッセージとして送ってください。<translated>AIの応答を含まない翻訳結果</translated>');
$content = Str::of($response->content())->between('<translated>','</translated>')->trim()->toString();
```
